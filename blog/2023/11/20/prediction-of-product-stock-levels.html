
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Personal Website">
      
      
        <meta name="author" content="Andrey Shtrauss">
      
      
        <link rel="canonical" href="https://shtrausslearning.github.io/blog/2023/11/20/prediction-of-product-stock-levels.html">
      
      
        <link rel="prev" href="../17/prediction-of-customer-stable-funds-volume.html">
      
      
        <link rel="next" href="../25/logistic-regression.html">
      
      
      <link rel="icon" href="../../../../images/home-logo.svg">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.17">
    
    
      
        <title>Prediction of Product Stock Levels - mldsai</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.bcfcd587.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
        <script src="https://unpkg.com/iframe-worker/shim"></script>
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Ubuntu";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../stylesheets/customize.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/simpleicons.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-R7CLKWM3LT"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-R7CLKWM3LT",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-R7CLKWM3LT",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="custom">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#prediction-of-product-stock-levels" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../index.html" title="mldsai" class="md-header__button md-logo" aria-label="mldsai" data-md-component="logo">
      
  <img src="../../../../images/home-logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            mldsai
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Prediction of Product Stock Levels
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="custom"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/shtrausslearning/shtrausslearning.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    shtrausslearning.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../index.html" class="md-tabs__link">
        
  
    
  
  <b>Home</b>

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../index.html#featured_work" class="md-tabs__link">
        
  
    
  
  <b>Featured</b>

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../index.html#portfolio" class="md-tabs__link">
        
  
    
  
  <b>Latest</b>

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../index.html" class="md-tabs__link">
          
  
    
  
  <b>Blog</b>

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../index.html" title="mldsai" class="md-nav__button md-logo" aria-label="mldsai" data-md-component="logo">
      
  <img src="../../../../images/home-logo.svg" alt="logo">

    </a>
    mldsai
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/shtrausslearning/shtrausslearning.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    shtrausslearning.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <b>Home</b>
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../index.html#featured_work" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <b>Featured</b>
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../index.html#portfolio" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <b>Latest</b>
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    <b>Blog</b>
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            <b>Blog</b>
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Archive
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../archive/2025/07.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    July, 2025
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../archive/2025/02.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    February, 2025
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../archive/2024/10.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    October, 2024
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../archive/2024/04.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    April, 2024
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../archive/2024/03.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    March, 2024
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../archive/2023/12.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    December, 2023
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../archive/2023/11.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    November, 2023
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../archive/2023/10.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    October, 2023
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../archive/2023/09.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    September, 2023
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../archive/2023/08.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    August, 2023
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Categories
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/recsys.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Recsys
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/code-model.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    code model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/eda.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    eda
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/internship.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    internship
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/nlp.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nlp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/pyspark.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pyspark
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/science.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    science
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/sql.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sql
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../category/uplift-modeling.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    uplift modeling
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#background" class="md-nav__link">
    <span class="md-ellipsis">
      Background
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Background">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#project-statement" class="md-nav__link">
    <span class="md-ellipsis">
      Project Statement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gala-groceries" class="md-nav__link">
    <span class="md-ellipsis">
      Gala Groceries
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clients-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      Clients dataset
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Clients dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preview" class="md-nav__link">
    <span class="md-ellipsis">
      Preview
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exploratory-data-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Exploratory Data Analysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exploratory Data Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#statistical-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Statistical Tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visualisations" class="md-nav__link">
    <span class="md-ellipsis">
      Visualisations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Visualisations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#category-based-statistics" class="md-nav__link">
    <span class="md-ellipsis">
      Category based statistics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#customer-type-visualisations" class="md-nav__link">
    <span class="md-ellipsis">
      Customer Type Visualisations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#framing-the-problem-statement" class="md-nav__link">
    <span class="md-ellipsis">
      Framing the Problem Statement
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Framing the Problem Statement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#letter-to-ds-lead" class="md-nav__link">
    <span class="md-ellipsis">
      Letter to DS lead
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      Model Diagram
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stategic-plan" class="md-nav__link">
    <span class="md-ellipsis">
      Stategic Plan
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#baseline-model" class="md-nav__link">
    <span class="md-ellipsis">
      Baseline Model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Baseline Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#datasets" class="md-nav__link">
    <span class="md-ellipsis">
      Datasets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      Preprocessing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Preprocessing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#converting-to-datetime" class="md-nav__link">
    <span class="md-ellipsis">
      Converting to datetime
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#converting-to-datetime_1" class="md-nav__link">
    <span class="md-ellipsis">
      Converting to datetime
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregations" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#merging-data" class="md-nav__link">
    <span class="md-ellipsis">
      Merging Data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-additional-features" class="md-nav__link">
    <span class="md-ellipsis">
      Adding Additional Features
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#feature-engineering" class="md-nav__link">
    <span class="md-ellipsis">
      Feature Engineering
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Feature Engineering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#time-based-features" class="md-nav__link">
    <span class="md-ellipsis">
      Time based features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#one-hot-encoding" class="md-nav__link">
    <span class="md-ellipsis">
      One-Hot Encoding
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modeling" class="md-nav__link">
    <span class="md-ellipsis">
      Modeling
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-optimisation" class="md-nav__link">
    <span class="md-ellipsis">
      Model Optimisation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Model Optimisation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#recap-preprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      Recap Preprocessing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#feature-transformations" class="md-nav__link">
    <span class="md-ellipsis">
      Feature Transformations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Feature Transformations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#column-transformations" class="md-nav__link">
    <span class="md-ellipsis">
      Column Transformations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#normalisation-of-columns" class="md-nav__link">
    <span class="md-ellipsis">
      Normalisation of columns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helper-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Helper Functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#training-models" class="md-nav__link">
    <span class="md-ellipsis">
      Training Models
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#contact-with-client" class="md-nav__link">
    <span class="md-ellipsis">
      Contact with Client
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#concluding-remarks" class="md-nav__link">
    <span class="md-ellipsis">
      Concluding Remarks
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../../../index.html" class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
                  <span class="md-ellipsis">
                    Back to index
                  </span>
                </a>
              </div>
            </div>
            
              <div class="md-post__authors md-typeset">
                
                  <div class="md-profile md-post__profile">
                    <span class="md-author md-author--long">
                      <img src="https://avatars.githubusercontent.com/u/79809117?v=4" alt="Andrey Shtrauss">
                    </span>
                    <span class="md-profile__description">
                      <strong>
                        
                          Andrey Shtrauss
                        
                      </strong>
                      <br>
                      Creator
                    </span>
                  </div>
                
              </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    Metadata
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5v-5Z"/></svg>
                        <time datetime="2023-11-20 00:00:00" class="md-ellipsis">November 20, 2023</time>
                      </div>
                    </li>
                    
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3H9m3 2 4 13 3-1-4-13-3 1M5 5v13h3V5H5M3 19v2h18v-2H3Z"/></svg>
                          <span class="md-ellipsis">
                            in
                            
                              <a href="../../../category/internship.html">internship</a></span>
                        </div>
                      </li>
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7h1.5Z"/></svg>
                          <span class="md-ellipsis">
                            
                              27 min read
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
          </nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  
  

<nav class="md-tags" >
  
    
    
    
      <span class="md-tag">regression</span>
    
  
    
    
    
      <span class="md-tag">business</span>
    
  
    
    
    
      <span class="md-tag">internship</span>
    
  
    
    
    
      <span class="md-tag">cognizant</span>
    
  
</nav>


  
  


<h1 id="prediction-of-product-stock-levels"><strong>Prediction of Product Stock Levels</strong><a class="headerlink" href="#prediction-of-product-stock-levels" title="Permanent link">&para;</a></h1>
<p><img alt="" src="../../../images/cognizant.jpg" /></p>
<p>In this project, we work with a client <strong>Gala Groceries</strong>, who has contacted <strong>Cognizant</strong> for logistics advice about <strong>product storage</strong> </p>
<ul>
<li>Specifically, they are interested in wanting to know <strong>how better stock the items that they sell</strong>. </li>
<li>Our role is to take on this project as a data scientist and understand what the client actually needs. This will result in the formulation/confirmation of a new project statement, in which we will be focusing on <strong>predicting stock levels of products</strong>. </li>
<li>Such a model would enable the client to estimate their product stock levels at a given time &amp; make subsequent business decisions in a more effective manner reducing understocking and overstocking losses.</li>
</ul>
<!-- more -->

<div class="grid cards">
<ul>
<li><span class="twemoji lg middle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></span>&nbsp; <b><a href="https://github.com/shtrausslearning/Data-Science-Portfolio/tree/main/cognizant_artificial_intelligence">GitHub Repository</a></b></li>
<li><span class="twemoji lg middle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M1.955 9.425C.842 9.425 0 10.265 0 11.38c0 1.132.821 1.953 1.953 1.953.73 0 1.374-.405 1.725-1.084l.01-.02-.695-.368-.009.023c-.206.437-.588.686-1.046.686-.663 0-1.18-.523-1.18-1.192 0-.686.515-1.202 1.197-1.202.442 0 .778.208 1 .617l.01.022.668-.427-.012-.019a1.906 1.906 0 0 0-1.666-.944zm20.78.189v.903h-.467v.673h.465v.876c0 .892.285 1.188 1.155 1.188h.108v-.701c-.459 0-.515-.066-.515-.493v-.87H24v-.673h-.515v-.903zm-9.858.002v.68h.75v-.68zm-4.727.845c-.619 0-1.33.456-1.33 1.425 0 .963.738 1.422 1.315 1.424.356 0 .647-.148.827-.362v.257c0 .356-.257.673-.662.673a.802.802 0 0 1-.761-.465l-.662.373c.22.428.73.79 1.425.79.926 0 1.413-.625 1.413-1.397v-2.662h-.75v.295a1.07 1.07 0 0 0-.815-.35zm9.599 0c-.619 0-1.331.456-1.331 1.425 0 .963.739 1.422 1.32 1.424.356 0 .646-.148.826-.362v.308h.75v-2.739h-.75v.266c-.18-.19-.459-.322-.815-.322zm-6.234.002a.941.941 0 0 0-.756.362v-.308h-.744v2.739h.75V11.76c0-.46.236-.656.52-.656.334 0 .505.214.505.581v1.57h.76v-1.67c0-.706-.389-1.122-1.035-1.122zm9.602 0a.941.941 0 0 0-.755.362v-.308h-.744l-.002 2.739h.75V11.76c0-.46.236-.656.52-.656.336 0 .505.214.505.581v1.57h.76v-1.67c0-.706-.387-1.122-1.034-1.122zm-15.9.01a1.42 1.42 0 0 0-1.423 1.413l-.002.01a1.42 1.42 0 1 0 1.425-1.423zm8.704.044v.662h1.42l-1.44 1.408v.669h2.474v-.664h-1.468l1.44-1.402v-.673zm-1.055.008v2.738h.75v-2.738zm-4.58.622c.406 0 .702.328.702.733 0 .405-.296.739-.701.739a.72.72 0 0 1-.733-.739c0-.422.317-.733.733-.733zm9.598 0c.405 0 .7.328.7.733.003.405-.293.739-.7.739a.72.72 0 0 1-.733-.739c0-.422.319-.735.733-.733zm-12.671.026c.382 0 .69.325.69.713a.704.704 0 0 1-.69.712c-.388 0-.684-.322-.684-.712 0-.39.296-.713.684-.713z"/></svg></span>&nbsp; <b><a href="https://www.theforage.com/simulations/cognizant/artificial-intelligence-rtbq">Cognizant Internship (Discontinued)</a></b></li>
</ul>
</div>
<h2 id="background"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 18H9a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h1v5l2-1.5L14 7V2h5a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2m-2 2v2H5a2 2 0 0 1-2-2V6h2v14h12Z"/></svg></span> <b>Background</b><a class="headerlink" href="#background" title="Permanent link">&para;</a></h2>
<h3 id="project-statement">Project Statement<a class="headerlink" href="#project-statement" title="Permanent link">&para;</a></h3>
<p>In this project, we aim to help <strong>Gala Groceries</strong> who have approached <strong>Cognizant</strong> to help them with supply chain issues. Specifically, <strong>they are interested in wanting to know how better stock the items that they sell</strong></p>
<blockquote>
<p>Can we accurately predict the stock levels of products based on sales data and sensor data on an hourly basis in order to more intelligently procure products from our suppliers?‚Äù </p>
</blockquote>
<h3 id="gala-groceries">Gala Groceries<a class="headerlink" href="#gala-groceries" title="Permanent link">&para;</a></h3>
<p>More information about the client:</p>
<ul>
<li><strong>Gala Groceries</strong> is a technology-led grocery store chain based in the USA. They rely heavily on new technologies, such as IoT to give them a competitive edge over other grocery stores. </li>
<li>They pride themselves on providing the best quality, fresh produce from locally sourced suppliers. However, this comes with many challenges to consistently deliver on this objective year-round.</li>
</ul>
<p><strong>Gala Groceries</strong> approached Cognizant to <strong>help them with a supply chain issue</strong>. <strong>Groceries are highly perishable items</strong>. <strong>If you overstock, you are wasting money on excessive storage and waste</strong>, but if you <strong>understock, then you risk losing customers</strong>. They want to know how to better stock the items that they sell.</p>
<p>This is a high-level business problem and will require you to dive into the data in order to formulate some questions and recommendations to the client about what else we need in order to answer that question</p>
<h2 id="clients-dataset"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 18H9a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h1v5l2-1.5L14 7V2h5a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2m-2 2v2H5a2 2 0 0 1-2-2V6h2v14h12Z"/></svg></span> <b>Clients dataset</b><a class="headerlink" href="#clients-dataset" title="Permanent link">&para;</a></h2>
<p>The client has agreed to share data in the form of <strong><code>sensor data</code></strong>.
- They use <strong>sensors to measure temperature storage facilities where products are stored</strong> in the warehouse,
- And they also use <strong>stock levels</strong> within the refrigerators and freezers in store</p>
<h3 id="preview">Preview<a class="headerlink" href="#preview" title="Permanent link">&para;</a></h3>
<p>Initially, the Data Engineering team is able to extract <strong>one weeks worth of sales data</strong> for one of the <strong>Gala Groceries</strong> stores, this will allow us to find some insights into the data and in general feel more confident with the data that we will be using in future machine learning modeling. Our task at hand is to summarise what we have learned from the data, as well as make some suggestions about what we will be needing in order to fulfill the <strong>business requirement</strong> of the client.</p>
<p>Let's take a look at our sample dataset:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>+--------------------+-------------------+--------------------+--------+-------------+----------+--------+-----+------------+
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>|      transaction_id|          timestamp|          product_id|category|customer_type|unit_price|quantity|total|payment_type|
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>+--------------------+-------------------+--------------------+--------+-------------+----------+--------+-----+------------+
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>|a1c82654-c52c-45b...|2022-03-02 09:51:38|3bc6c1ea-0198-46d...|   fruit|         gold|      3.99|       2| 7.98|    e-wallet|
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>|931ad550-09e8-4da...|2022-03-06 10:33:59|ad81b46c-bf38-41c...|   fruit|     standard|      3.99|       1| 3.99|    e-wallet|
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>|ae133534-6f61-4cd...|2022-03-04 17:20:21|7c55cbd4-f306-4c0...|   fruit|      premium|      0.19|       2| 0.38|    e-wallet|
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>|157cebd9-aaf0-475...|2022-03-02 17:23:58|80da8348-1707-403...|   fruit|         gold|      0.19|       4| 0.76|    e-wallet|
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>|a81a6cd3-5e0c-44a...|2022-03-05 14:32:43|7f5e86e6-f06f-45f...|   fruit|        basic|      4.49|       2| 8.98|  debit card|
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>+--------------------+-------------------+--------------------+--------+-------------+----------+--------+-----+------------+
</code></pre></div>
<p>We have the following <strong>features</strong></p>
<ul>
<li><strong>transaction_id</strong> : represents a unique transaction identified</li>
<li><strong>timestamp</strong> : time at which a product was purchased</li>
<li><strong>product_id</strong> : the unique identifier of the product which was purchased</li>
<li><strong>category</strong> : the category of product which was purchased</li>
<li><strong>unit_price</strong> : the price of the purchased product</li>
<li><strong>quantity</strong> : the ammount of product purchased</li>
<li><strong>total</strong> : the total ammount of product purchased</li>
<li><strong>payment_type</strong> : the type of payment which the client used to purchase the product</li>
</ul>
<h2 id="exploratory-data-analysis"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 18H9a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h1v5l2-1.5L14 7V2h5a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2m-2 2v2H5a2 2 0 0 1-2-2V6h2v14h12Z"/></svg></span> <b>Exploratory Data Analysis</b><a class="headerlink" href="#exploratory-data-analysis" title="Permanent link">&para;</a></h2>
<h3 id="statistical-tests">Statistical Tests<a class="headerlink" href="#statistical-tests" title="Permanent link">&para;</a></h3>
<p>Statistical tests are quite useful to check some hypothesis that can arise, let's use chi2 test to analyse the relationship between <strong>two categorical variables</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pingouin</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pg</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="k">def</span><span class="w"> </span><span class="nf">crosstables</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">cat1</span><span class="p">,</span><span class="n">cat2</span><span class="p">):</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Frequencies &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&#39;</span><span class="p">)</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>    <span class="n">w</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">cat1</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="n">cat2</span><span class="p">])</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Chi-square test &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&#39;</span><span class="p">)</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>    <span class="n">e</span><span class="p">,</span><span class="n">o</span><span class="p">,</span><span class="n">st</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">chi2_independence</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">cat1</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">cat2</span><span class="p">)</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chi-Square Statistic:&quot;</span><span class="p">)</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">show</span><span class="p">())</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="n">crosstables</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="s1">&#39;customer_type&#39;</span><span class="p">,</span><span class="s1">&#39;quantity&#39;</span><span class="p">)</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="n">crosstables</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="s1">&#39;customer_type&#39;</span><span class="p">,</span><span class="s1">&#39;payment_type&#39;</span><span class="p">)</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="n">crosstables</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="s1">&#39;payment_type&#39;</span><span class="p">,</span><span class="s1">&#39;quantity&#39;</span><span class="p">)</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="n">crosstables</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="s1">&#39;category&#39;</span><span class="p">,</span><span class="s1">&#39;customer_type&#39;</span><span class="p">)</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="n">crosstables</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="s1">&#39;category&#39;</span><span class="p">,</span><span class="s1">&#39;quantity&#39;</span><span class="p">)</span>
</code></pre></div>
<p>Let's check is there is any relationship between <strong>customer_type</strong> &amp; <strong>quantities</strong> purchased</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Frequencies &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>quantity         1    2    3    4
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>customer_type                    
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>basic          405  350  395  376
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>gold           379  383  374  381
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>non-member     420  395  378  408
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>premium        384  397  422  387
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>standard       391  395  385  424
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Chi-square test &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>Chi-Square Statistic:
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>+------------------+------+------+----+-----+------+-----+
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>|              test|lambda|  chi2| dof| pval|cramer|power|
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>+------------------+------+------+----+-----+------+-----+
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>|           pearson|   1.0| 10.52|12.0| 0.57| 0.021|0.175|
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>|      cressie-read| 0.667| 10.52|12.0| 0.57| 0.021|0.175|
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>|    log-likelihood|   0.0| 10.52|12.0| 0.57| 0.021|0.175|
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>|     freeman-tukey|  -0.5|10.522|12.0| 0.57| 0.021|0.175|
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>|mod-log-likelihood|  -1.0|10.525|12.0| 0.57| 0.021|0.175|
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>|            neyman|  -2.0|10.534|12.0|0.569| 0.021|0.176|
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>+------------------+------+------+----+-----+------+-----+
</code></pre></div>
<p>Since the P value(pearson) is greater than 0.05 so there is <strong>no actual relationship between the </strong>customer_type<strong> and </strong>quantities**</p>
<p>Let's check is there is any relationship between <strong>customer_type</strong> &amp; <strong>payment_type</strong> purchased</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Frequencies &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>payment_type   cash  credit card  debit card  e-wallet
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>customer_type                                         
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>basic           373          386         391       376
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>gold            358          389         352       418
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>non-member      434          396         402       369
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>premium         434          382         388       386
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>standard        428          396         385       386
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Chi-square test &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>Chi-Square Statistic:
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>+------------------+------+------+----+-----+------+-----+
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>|              test|lambda|  chi2| dof| pval|cramer|power|
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>+------------------+------+------+----+-----+------+-----+
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>|           pearson|   1.0|17.135|12.0|0.145| 0.027|0.282|
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>|      cressie-read| 0.667|17.116|12.0|0.145| 0.027|0.282|
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>|    log-likelihood|   0.0|17.084|12.0|0.146| 0.027|0.281|
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>|     freeman-tukey|  -0.5|17.066|12.0|0.147| 0.027|0.281|
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>|mod-log-likelihood|  -1.0|17.051|12.0|0.148| 0.027| 0.28|
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>|            neyman|  -2.0|17.036|12.0|0.148| 0.027| 0.28|
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>+------------------+------+------+----+-----+------+-----+
</code></pre></div>
<p>Since the P value(pearson) is greater than 0.05 so there is <strong>no actual relationship between the </strong>customer_type<strong> and </strong>quantities**</p>
<p>Let's check is there is any relationship between <strong>payment_type</strong> &amp; <strong>payment_type</strong> purchased</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Frequencies &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>quantity        1    2    3    4
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>payment_type                    
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>cash          480  502  495  550
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>credit card   506  485  460  498
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>debit card    483  451  488  496
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>e-wallet      510  482  511  432
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Chi-square test &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>Chi-Square Statistic:
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>+------------------+------+------+---+-----+------+-----+
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>|              test|lambda|  chi2|dof| pval|cramer|power|
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>+------------------+------+------+---+-----+------+-----+
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>|           pearson|   1.0|17.613|9.0| 0.04| 0.027|0.331|
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>|      cressie-read| 0.667|17.687|9.0|0.039| 0.027|0.333|
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>|    log-likelihood|   0.0|17.843|9.0|0.037| 0.028|0.336|
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>|     freeman-tukey|  -0.5|17.966|9.0|0.036| 0.028|0.338|
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>|mod-log-likelihood|  -1.0|18.095|9.0|0.034| 0.028|0.341|
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>|            neyman|  -2.0|18.371|9.0|0.031| 0.028|0.346|
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>+------------------+------+------+---+-----+------+-----+
</code></pre></div>
<p>Since all the p value(pearson) are lower than 0.05 so there is a relationship between <strong>payment_type</strong>  and <strong>quantity</strong>. However, there is a very weak association between the payment type and quantity variables</p>
<p>Let's check is there is any relationship between <strong>category</strong> &amp; <strong>customer_type</strong> purchased</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Frequencies &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>customer_type          basic  gold  non-member  premium  standard
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>category                                                         
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>baby products             49    46          45       39        45
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>baked goods               87    73          85       89       109
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>baking                    53    55          47       55        54
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>beverages                 66    47          57       63        68
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>canned foods              89    77          88       93        84
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>cheese                    42    63          77       60        51
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>cleaning products         57    56          67       63        49
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>condiments and sauces     35    37          37       37        35
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>dairy                     71    71          82       76        75
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>frozen                    45    59          48       55        56
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>fruit                    186   197         187      206       222
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>kitchen                   85    79          64       76        78
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>meat                      78    82          73       77        72
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>medicine                  47    41          63       52        40
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>packaged foods           106    94         101      104       102
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>personal care             30    45          33       31        38
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>pets                      26    34          36       36        29
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>refrigerated items        90    73         102       76        84
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>seafood                   44    50          54       55        50
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a>snacks                    59    50          52       44        58
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a>spices and herbs          21    14          26       21        43
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a>vegetables               160   174         177      182       153
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a>
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Chi-square test &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
<a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a>Chi-Square Statistic:
<a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a>+------------------+------+------+----+-----+------+-----+
<a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a>|              test|lambda|  chi2| dof| pval|cramer|power|
<a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a>+------------------+------+------+----+-----+------+-----+
<a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a>|           pearson|   1.0|87.391|84.0|0.378| 0.053|0.467|
<a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a>|      cressie-read| 0.667|86.838|84.0|0.394| 0.053|0.463|
<a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a>|    log-likelihood|   0.0|86.121|84.0|0.415| 0.052|0.459|
<a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a>|     freeman-tukey|  -0.5|85.907|84.0|0.422| 0.052|0.458|
<a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a>|mod-log-likelihood|  -1.0|85.964|84.0| 0.42| 0.052|0.458|
<a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a>|            neyman|  -2.0|86.886|84.0|0.393| 0.053|0.464|
<a id="__codelineno-5-39" name="__codelineno-5-39" href="#__codelineno-5-39"></a>+------------------+------+------+----+-----+------+-----+
</code></pre></div>
<p>Since all the p value(pearson) are greater than 0.05 so there is no relationship between <strong>customer_type</strong> and <strong>category</strong></p>
<p>Let's check is there is any relationship between <strong>category</strong> &amp; <strong>quantity</strong> purchased</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Frequencies &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>quantity                 1    2    3    4
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>category                                 
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>baby products           57   67   48   52
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>baked goods            122  107  103  111
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>baking                  73   63   63   65
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>beverages               69   71   79   82
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>canned foods           106  110  104  111
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>cheese                  57   66   86   84
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>cleaning products       77   75   62   78
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>condiments and sauces   43   48   49   41
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>dairy                   92   89   96   98
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>frozen                  65   61   75   62
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>fruit                  271  251  238  238
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>kitchen                 93   98   98   93
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>meat                   107   87   94   94
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>medicine                60   65   60   58
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>packaged foods         129  118  125  135
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>personal care           39   43   50   45
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>pets                    39   51   30   41
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>refrigerated items     112  100   99  114
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>seafood                 54   58   65   76
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>snacks                  69   62   69   63
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>spices and herbs        34   28   38   25
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>vegetables             211  202  223  210
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Chi-square test &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a>Chi-Square Statistic:
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a>+------------------+------+------+----+-----+------+-----+
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a>|              test|lambda|  chi2| dof| pval|cramer|power|
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a>+------------------+------+------+----+-----+------+-----+
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a>|           pearson|   1.0| 46.05|63.0|0.946| 0.044|0.361|
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a>|      cressie-read| 0.667|46.011|63.0|0.947| 0.044| 0.36|
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a>|    log-likelihood|   0.0|46.008|63.0|0.947| 0.044| 0.36|
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a>|     freeman-tukey|  -0.5|46.071|63.0|0.946| 0.044|0.361|
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a>|mod-log-likelihood|  -1.0|46.191|63.0|0.945| 0.044|0.362|
<a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a>|            neyman|  -2.0| 46.61|63.0|0.939| 0.045|0.366|
<a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a>+------------------+------+------+----+-----+------+-----+
</code></pre></div>
<p>Since all the p value(pearson) are greater than 0.05 so there is no relationship between <strong>category</strong> and <strong>quantity</strong></p>
<p>From most tests we can conclude that there is only a relationship between <strong>payment_type</strong> and <strong>quantity</strong> amongst the tested categorical column comparison cases</p>
<h3 id="visualisations">Visualisations<a class="headerlink" href="#visualisations" title="Permanent link">&para;</a></h3>
<p>Visualisation &amp; utilisation of data wrangling to understand our data a little more and feel more comfortable with it is an important part of a DS project, some interesting findings are included below:</p>
<h4 id="category-based-statistics">Category based statistics<a class="headerlink" href="#category-based-statistics" title="Permanent link">&para;</a></h4>
<p><strong>Meat</strong>, <strong>kitchen</strong>, <strong>seafood</strong> &amp; <strong>medicine</strong> are amongst the highely prices units, <strong>snacks</strong> &amp; <strong>fruit</strong> are amongst the more cheaper items sold at the store</p>
<p><img alt="" src="../../../images/eda1.png" /></p>
<p>The <strong>total sum</strong> of purchases gives us the following information: </p>
<p><img alt="" src="../../../images/eda5.png" /></p>
<h4 id="customer-type-visualisations">Customer Type Visualisations<a class="headerlink" href="#customer-type-visualisations" title="Permanent link">&para;</a></h4>
<p>Whilst we will be more focusing on the task of creating a model that will predict the estimated stock levels, some interesting insights into customer purchases are still interesting to explore, for example, on average <strong>non members tend to buy more beverages</strong>, <strong>gold members tend to procure more cheese products</strong>, <strong>premium members tend to produre more personalised case products</strong></p>
<p><img alt="" src="../../../images/eda2.png" /></p>
<p>We can also visualise the mean producure ment values for each category, <strong>premium and basic</strong> members tend to spend more on <strong>baby products</strong></p>
<p><img alt="" src="../../../images/eda3.png" /></p>
<p>We can divide our data into different days and visualise the <strong>procurement mean of each customer_type</strong>. <strong>premium and non-members</strong> tend to spend the most</p>
<p><img alt="" src="../../../images/eda4.png" /></p>
<p>Let's look at the breakdown of the contibution to the total procurement of each customer type across each category</p>
<p><img alt="" src="../../../images/eda6.png" /></p>
<p>Of course there are many more things we can explore, let's focus on the business task at hand and write an email to the <strong>DS lead</strong> about the client's request.</p>
<h2 id="framing-the-problem-statement"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 18H9a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h1v5l2-1.5L14 7V2h5a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2m-2 2v2H5a2 2 0 0 1-2-2V6h2v14h12Z"/></svg></span> <strong>Framing the Problem Statement</strong><a class="headerlink" href="#framing-the-problem-statement" title="Permanent link">&para;</a></h2>
<h3 id="letter-to-ds-lead">Letter to DS lead<a class="headerlink" href="#letter-to-ds-lead" title="Permanent link">&para;</a></h3>
<p>We have to email the findings of our data exploration &amp; discuss our ideas about the client's needs</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>    Dear [insert name of recipient]
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    I received the sample dataset from the Data Engineering team and I‚Äôve been analysing the sample on behalf of the Data Science team.
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    I found the following insights as part of the analysis:
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>    - Fruit &amp; vegetables are the 2 most frequently bought product categories
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>    - Non-members are the most frequent buyers within the store
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>    - Cash is the most frequently used payment method
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>    - 11am is the busiest hour with regards to number of transactions
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>    - On average non-members overspent gold, standard and basic members &amp; premium members spent the most
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>    As a reminder, the client has indicated that they wanted to know the following: ‚ÄúHow to better stock the items that they sell.‚Äù
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>    With respect to this business question, my recommendations are the following:
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>    As this is a very broad statement, we need to identify a specific problem statement that the business would like to solve, so as an example, we can focus on predicting the store demand on an hourly basis, in order to smooth out the procurement logistics of each store so that they procure only the necessary product quantities on a weekly basis. We obviously need more data, the current sample only covers a week worth of data at a single store.
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>    Based on the problem statement that we move forward with, we will need more informative dataset features related to stocking of products, for example, if we‚Äôre modelling demand for products, we may want to include information about stock levels or weather conditions, customer spending habits, all these feature combinations must be tested.
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>    Kind Regards, 
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a>    [name of sender]
</code></pre></div>
<h3 id="model-diagram">Model Diagram<a class="headerlink" href="#model-diagram" title="Permanent link">&para;</a></h3>
<p>Having clarified the <strong>problem statement</strong>, the data engineering team has provided a data model of the available tables of data that has been provided by the client, based on different sensor readings</p>
<p><strong>sales table</strong> is the same as in our initial <strong>Initial Data Exploration</strong> (with the exception that we have more data now). </p>
<p>Additional <strong>IoT</strong> data (as per our request):</p>
<ul>
<li>The client has sensors that <strong>monitor the estimated stock</strong> of each product <code>product_id</code>, <code>estimated_stock_pct</code> (this will be our <strong>target variable</strong>), this is stored in <mark><strong>sensor_stock_levels</strong></mark> table.</li>
<li><strong>sensor</strong> data is also available to us, this data monitors the storage facility <strong>temperature data</strong>, this is stored in table <mark><strong>sensor_storage_temperature</strong></mark></li>
<li>As before we have the sales data stored in the <mark><strong>sales</strong></mark> table</li>
</ul>
<p><img alt="" src="../../../images/tables.png" /></p>
<h3 id="stategic-plan">Stategic Plan<a class="headerlink" href="#stategic-plan" title="Permanent link">&para;</a></h3>
<p>Lets define a plan as to how we'll use the data to solve the problem statement that the client has positioned. This plan will be used to describe to the client <strong>how we are planning to complete the remaining work and to build trust with the client</strong> as a domain expert</p>
<p><img alt="" src="../../../images/path.png" /></p>
<p><br></p>
<hr />
<h2 id="baseline-model"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 18H9a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h1v5l2-1.5L14 7V2h5a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2m-2 2v2H5a2 2 0 0 1-2-2V6h2v14h12Z"/></svg></span> <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.573.677A.25.25 0 0 1 10 .854V2.5h1A2.5 2.5 0 0 1 13.5 5v5.628a2.251 2.251 0 1 1-1.5 0V5a1 1 0 0 0-1-1h-1v1.646a.25.25 0 0 1-.427.177L7.177 3.427a.25.25 0 0 1 0-.354ZM6 12v-1.646a.25.25 0 0 1 .427-.177l2.396 2.396a.25.25 0 0 1 0 .354l-2.396 2.396A.25.25 0 0 1 6 15.146V13.5H5A2.5 2.5 0 0 1 2.5 11V5.372a2.25 2.25 0 1 1 1.5 0V11a1 1 0 0 0 1 1ZM4 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0ZM12.75 12a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Z"/></svg></span> <strong>Baseline Model</strong><a class="headerlink" href="#baseline-model" title="Permanent link">&para;</a></h2>
<p>Modeling is an <strong>iterative process</strong>, let's begin with a <strong>general baseline</strong>, upon which we will try to improve, by considering a much larger range of preprocessing &amp; model options. As defined in the <strong>strategic plan</strong>, we will go through most of the steps, however we'll keep things a little more simple at first, and do more testing in subsequent iterations. </p>
<ul>
<li><strong>Preprocessing</strong>: Filling NaN, Adding Date Features, Adding one-hot-encoding of <strong>category</strong></li>
<li><strong>Modeling</strong>: <strong>RandomForest</strong> with default hyperparameters, we test <strong>10 random splits</strong> and average <strong>the MAE</strong></li>
</ul>
<h3 id="datasets">Datasets<a class="headerlink" href="#datasets" title="Permanent link">&para;</a></h3>
<p>Samples from the <strong>three datasets</strong> are defined above can be visualised below:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>+--------------------+-------------------+--------------------+--------+-------------+----------+--------+-----+------------+
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>|      transaction_id|          timestamp|          product_id|category|customer_type|unit_price|quantity|total|payment_type|
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>+--------------------+-------------------+--------------------+--------+-------------+----------+--------+-----+------------+
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>|a1c82654-c52c-45b...|2022-03-02 09:51:38|3bc6c1ea-0198-46d...|   fruit|         gold|      3.99|       2| 7.98|    e-wallet|
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>|931ad550-09e8-4da...|2022-03-06 10:33:59|ad81b46c-bf38-41c...|   fruit|     standard|      3.99|       1| 3.99|    e-wallet|
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>|ae133534-6f61-4cd...|2022-03-04 17:20:21|7c55cbd4-f306-4c0...|   fruit|      premium|      0.19|       2| 0.38|    e-wallet|
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>|157cebd9-aaf0-475...|2022-03-02 17:23:58|80da8348-1707-403...|   fruit|         gold|      0.19|       4| 0.76|    e-wallet|
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>|a81a6cd3-5e0c-44a...|2022-03-05 14:32:43|7f5e86e6-f06f-45f...|   fruit|        basic|      4.49|       2| 8.98|  debit card|
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>+--------------------+-------------------+--------------------+--------+-------------+----------+--------+-----+------------+
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>+--------------------+-------------------+--------------------+-------------------+
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>|                  id|          timestamp|          product_id|estimated_stock_pct|
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>+--------------------+-------------------+--------------------+-------------------+
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>|4220e505-c247-478...|2022-03-07 12:13:02|f658605e-75f3-4fe...|               0.75|
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>|f2612b26-fc82-49e...|2022-03-07 16:39:46|de06083a-f5c0-451...|               0.48|
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>|989a287f-67e6-447...|2022-03-01 18:17:43|ce8f3a04-d1a4-43b...|               0.58|
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>|af8e5683-d247-46a...|2022-03-02 14:29:09|c21e3ba9-92a3-474...|               0.79|
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>|08a32247-3f44-400...|2022-03-02 13:46:18|7f478817-aa5b-44e...|               0.22|
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>+--------------------+-------------------+--------------------+-------------------+
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>+--------------------+-------------------+-----------+
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>|                  id|          timestamp|temperature|
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>+--------------------+-------------------+-----------+
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>|d1ca1ef8-0eac-42f...|2022-03-07 15:55:20|       2.96|
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>|4b8a66c4-0f3a-4f1...|2022-03-01 09:18:22|       1.88|
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>|3d47a0c7-1e72-451...|2022-03-04 15:12:26|       1.78|
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>|9500357b-ce15-424...|2022-03-02 12:30:42|       2.18|
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>|c4b61fec-99c2-4c6...|2022-03-05 09:09:33|       1.38|
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>+--------------------+-------------------+-----------+
</code></pre></div>
<h3 id="preprocessing">Preprocessing<a class="headerlink" href="#preprocessing" title="Permanent link">&para;</a></h3>
<h4 id="converting-to-datetime">Converting to datetime<a class="headerlink" href="#converting-to-datetime" title="Permanent link">&para;</a></h4>
<p>We first need to convert the <strong>str</strong> format columns into <strong>datetime</strong> columns</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">convert_to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>  <span class="n">dummy</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>  <span class="n">dummy</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">dummy</span><span class="p">[</span><span class="n">column</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>  <span class="k">return</span> <span class="n">dummy</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="n">sales_df</span> <span class="o">=</span> <span class="n">convert_to_datetime</span><span class="p">(</span><span class="n">sales_df</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="n">stock_df</span> <span class="o">=</span> <span class="n">convert_to_datetime</span><span class="p">(</span><span class="n">stock_df</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="n">temp_df</span> <span class="o">=</span> <span class="n">convert_to_datetime</span><span class="p">(</span><span class="n">temp_df</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
</code></pre></div>
<h4 id="converting-to-datetime_1"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25Zm0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41L8 2.694Z"/></svg></span> Converting to datetime<a class="headerlink" href="#converting-to-datetime_1" title="Permanent link">&para;</a></h4>
<p>If we revisit the problem statement: </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>‚ÄúCan we accurately predict the stock levels of products, based on sales data and sensor data, 
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>on an hourly basis in order to more intelligently procure products from our suppliers.‚Äù
</code></pre></div>
<ul>
<li>The client indicates that they want the model to <strong>predict on an hourly basis</strong>. </li>
<li>Looking at the data model, we can see that only column that we can use to merge the 3 datasets together is <strong>timestamp</strong></li>
<li>So, we must first transform the <strong>timestamp</strong> column in all 3 datasets to be based on the <strong>hour of the day</strong>, then we can merge the datasets together</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="c1"># helper function to convert datetime to desired format</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">convert_timestamp_to_hourly</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>  <span class="n">dummy</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>  <span class="n">new_ts</span> <span class="o">=</span> <span class="n">dummy</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="c1"># timestamp list [Timestamp(),Timestamp(),...]</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>  <span class="n">new_ts</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:00:00&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">new_ts</span><span class="p">]</span> <span class="c1"># change the value of timestamp</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>  <span class="n">new_ts</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:00:00&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">new_ts</span><span class="p">]</span> <span class="c1"># change to datetime</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>  <span class="n">dummy</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_ts</span> <span class="c1"># replace</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>  <span class="k">return</span> <span class="n">dummy</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="n">sales_df</span> <span class="o">=</span> <span class="n">convert_timestamp_to_hourly</span><span class="p">(</span><span class="n">sales_df</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="n">stock_df</span> <span class="o">=</span> <span class="n">convert_timestamp_to_hourly</span><span class="p">(</span><span class="n">stock_df</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="n">temp_df</span> <span class="o">=</span> <span class="n">convert_timestamp_to_hourly</span><span class="p">(</span><span class="n">temp_df</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
</code></pre></div>
<h4 id="aggregations">Aggregations<a class="headerlink" href="#aggregations" title="Permanent link">&para;</a></h4>
<p>For the <strong>sales</strong> data, we want to group the data by <strong>timestamp</strong> but also by <strong>product_id</strong>. When we aggregate, since the client is interested in <strong>hourly product estimates</strong>. We must choose which columns to aggregate by the grouping. For now, let's aggregate quantity and get the total sum.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">sales_agg</span> <span class="o">=</span> <span class="n">sales_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;product_id&#39;</span><span class="p">],</span><span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;quantity&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">})</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="c1"># +-------------------+--------------------+--------+</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="c1"># |          timestamp|          product_id|quantity|</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="c1"># +-------------------+--------------------+--------+</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="c1"># |2022-03-01 09:00:00|00e120bb-89d6-4df...|       3|</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="c1"># |2022-03-01 09:00:00|01f3cdd9-8e9e-4df...|       3|</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="c1"># |2022-03-01 09:00:00|03a2557a-aa12-4ad...|       3|</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="c1"># |2022-03-01 09:00:00|049b2171-0eeb-4a3...|       7|</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="c1"># |2022-03-01 09:00:00|04da844d-8dba-447...|      11|</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="c1"># +-------------------+--------------------+--------+</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="n">stock_agg</span> <span class="o">=</span> <span class="n">stock_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;product_id&#39;</span><span class="p">],</span><span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;estimated_stock_pct&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">})</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="c1"># +-------------------+--------------------+-------------------+</span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="c1"># |          timestamp|          product_id|estimated_stock_pct|</span>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="c1"># +-------------------+--------------------+-------------------+</span>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="c1"># |2022-03-01 09:00:00|00e120bb-89d6-4df...|               0.89|</span>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="c1"># |2022-03-01 09:00:00|01f3cdd9-8e9e-4df...|               0.14|</span>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="c1"># |2022-03-01 09:00:00|01ff0803-ae73-423...|               0.67|</span>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="c1"># |2022-03-01 09:00:00|0363eb21-8c74-47e...|               0.82|</span>
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a><span class="c1"># |2022-03-01 09:00:00|03f0b20e-3b5b-444...|               0.05|</span>
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a><span class="c1"># +-------------------+--------------------+-------------------+</span>
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a><span class="n">temp_agg</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span><span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;temperature&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">})</span>
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>
<a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a><span class="c1"># +-------------------+--------------------+</span>
<a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a><span class="c1"># |          timestamp|         temperature|</span>
<a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a><span class="c1"># +-------------------+--------------------+</span>
<a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a><span class="c1"># |2022-03-01 09:00:00|-0.02884984025559...|</span>
<a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a><span class="c1"># |2022-03-01 10:00:00|  1.2843137254901962|</span>
<a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a><span class="c1"># |2022-03-01 11:00:00|               -0.56|</span>
<a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a><span class="c1"># |2022-03-01 12:00:00| -0.5377210884353741|</span>
<a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a><span class="c1"># |2022-03-01 13:00:00|-0.18873417721518987|</span>
<a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a><span class="c1"># +-------------------+--------------------+</span>
</code></pre></div>
<p><strong><code>sales_agg</code></strong> : We now have an aggregated sales data where each row represents a unique combination of hour during which the sales took place from that weeks worth of data and the product_id. We summed the quantity and we took the mean average of the unit_price</p>
<p><strong><code>stock_agg</code></strong> : This shows us the average stock percentage of each product at unique hours within the week of sample data</p>
<p><strong><code>temp_agg</code></strong> : This gives us the average temperature of the storage facility where the produce is stored in the warehouse by unique hours during the week</p>
<h4 id="merging-data">Merging Data<a class="headerlink" href="#merging-data" title="Permanent link">&para;</a></h4>
<p>Currently we have 3 datasets. In order to include all of this data within a predictive model, we need to merge them together into 1 dataframe. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1"># merge sales &amp; stock </span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="n">merged_df</span> <span class="o">=</span> <span class="n">stock_agg</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">sales_agg</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;product_id&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="n">merged_df</span> <span class="o">=</span> <span class="n">merged_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">temp_agg</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="n">merged_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>Int64Index: 10845 entries, 0 to 10844
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>Data columns (total 5 columns):
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a> #   Column               Non-Null Count  Dtype         
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>---  ------               --------------  -----         
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a> 0   timestamp            10845 non-null  datetime64[ns]
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a> 1   product_id           10845 non-null  object        
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a> 2   estimated_stock_pct  10845 non-null  float64       
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a> 3   quantity             3067 non-null   float64       
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a> 4   temperature          10845 non-null  float64       
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>dtypes: datetime64[ns](1), float64(3), object(1)
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>memory usage: 508.4+ KB
</code></pre></div>
<p>We can see from the <code>.info()</code> method that we have some null values. These need to be treated before we can build a predictive model. The column that features some null values is quantity. We can assume that if there is a null value for this column, it represents that there were 0 sales of this product within this hour. So, lets fill this columns null values with 0</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>
<h4 id="adding-additional-features">Adding Additional Features<a class="headerlink" href="#adding-additional-features" title="Permanent link">&para;</a></h4>
<p>Next, we can add the <strong>category</strong> &amp; <strong>unit_price</strong> to each of the rows by creating unique <code>product_id</code> tables</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">product_categories</span> <span class="o">=</span> <span class="n">sales_df</span><span class="p">[[</span><span class="s1">&#39;product_id&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">]]</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="n">product_categories</span> <span class="o">=</span> <span class="n">product_categories</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="n">product_price</span> <span class="o">=</span> <span class="n">sales_df</span><span class="p">[[</span><span class="s1">&#39;product_id&#39;</span><span class="p">,</span> <span class="s1">&#39;unit_price&#39;</span><span class="p">]]</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="n">product_price</span> <span class="o">=</span> <span class="n">product_price</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">merged_df</span> <span class="o">=</span> <span class="n">merged_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">product_categories</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;product_id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="n">merged_df</span> <span class="o">=</span> <span class="n">merged_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">product_price</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;product_id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="n">merged_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>+-------------------+--------------------+-------------------+--------+--------------------+-------------+------------+------------+----------+
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>|          timestamp|          product_id|estimated_stock_pct|quantity|         temperature|     category|unit_price_x|unit_price_y|unit_price|
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>+-------------------+--------------------+-------------------+--------+--------------------+-------------+------------+------------+----------+
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>|2022-03-01 09:00:00|00e120bb-89d6-4df...|               0.89|     3.0|-0.02884984025559...|      kitchen|       11.19|       11.19|     11.19|
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>|2022-03-01 09:00:00|01f3cdd9-8e9e-4df...|               0.14|     3.0|-0.02884984025559...|   vegetables|        1.49|        1.49|      1.49|
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>|2022-03-01 09:00:00|01ff0803-ae73-423...|               0.67|     0.0|-0.02884984025559...|baby products|       14.19|       14.19|     14.19|
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>|2022-03-01 09:00:00|0363eb21-8c74-47e...|               0.82|     0.0|-0.02884984025559...|    beverages|       20.19|       20.19|     20.19|
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>|2022-03-01 09:00:00|03f0b20e-3b5b-444...|               0.05|     0.0|-0.02884984025559...|         pets|        8.19|        8.19|      8.19|
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>+-------------------+--------------------+-------------------+--------+--------------------+-------------+------------+------------+----------+
</code></pre></div>
<h3 id="feature-engineering">Feature Engineering<a class="headerlink" href="#feature-engineering" title="Permanent link">&para;</a></h3>
<h4 id="time-based-features"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 17H7V3h14m0-2H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2m-7 14h2V5h-4v2h2M3 5H1v16a2 2 0 0 0 2 2h16v-2H3V5Z"/></svg></span> Time based features<a class="headerlink" href="#time-based-features" title="Permanent link">&para;</a></h4>
<p>Intuitively, time based features often have has significant relevance</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;dow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="n">merged_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>+--------------------+-------------------+--------+--------------------+-------------+----------+---+---+----+
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>|          product_id|estimated_stock_pct|quantity|         temperature|     category|unit_price|day|dow|hour|
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>+--------------------+-------------------+--------+--------------------+-------------+----------+---+---+----+
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>|00e120bb-89d6-4df...|               0.89|     3.0|-0.02884984025559...|      kitchen|     11.19|  1|  1|   9|
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>|01f3cdd9-8e9e-4df...|               0.14|     3.0|-0.02884984025559...|   vegetables|      1.49|  1|  1|   9|
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>|01ff0803-ae73-423...|               0.67|     0.0|-0.02884984025559...|baby products|     14.19|  1|  1|   9|
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>|0363eb21-8c74-47e...|               0.82|     0.0|-0.02884984025559...|    beverages|     20.19|  1|  1|   9|
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>|03f0b20e-3b5b-444...|               0.05|     0.0|-0.02884984025559...|         pets|      8.19|  1|  1|   9|
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>+--------------------+-------------------+--------+--------------------+-------------+----------+---+---+----+
</code></pre></div>
<h4 id="one-hot-encoding"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 13h-4v-2h2a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-4v2h4v2h-2a2 2 0 0 0-2 2v4h6m4 2H7V3h14m0-2H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2M3 5H1v16a2 2 0 0 0 2 2h16v-2H3V5Z"/></svg></span> One-Hot Encoding<a class="headerlink" href="#one-hot-encoding" title="Permanent link">&para;</a></h4>
<p>We have a few categorical features, which we need to preprocess if they are to be used in our model, lets start with <strong>one hot encoding</strong> of <code>category</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">merged_df</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">])</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">merged_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>Int64Index: 10845 entries, 0 to 10844
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>Data columns (total 31 columns):
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a> #   Column                          Non-Null Count  Dtype         
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>---  ------                          --------------  -----         
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a> 0   timestamp                       10845 non-null  datetime64[ns]
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a> 1   product_id                      10845 non-null  object        
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a> 2   estimated_stock_pct             10845 non-null  float64       
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a> 3   quantity                        10845 non-null  float64       
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a> 4   temperature                     10845 non-null  float64       
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a> 5   unit_price                      10845 non-null  float64       
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a> 6   day                             10845 non-null  int64         
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a> 7   dow                             10845 non-null  int64         
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a> 8   hour                            10845 non-null  int64         
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a> 9   category_baby products          10845 non-null  uint8         
<a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a> 10  category_baked goods            10845 non-null  uint8         
<a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a> 11  category_baking                 10845 non-null  uint8         
<a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a> 12  category_beverages              10845 non-null  uint8         
<a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a> 13  category_canned foods           10845 non-null  uint8         
<a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a> 14  category_cheese                 10845 non-null  uint8         
<a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a> 15  category_cleaning products      10845 non-null  uint8         
<a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a> 16  category_condiments and sauces  10845 non-null  uint8         
<a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a> 17  category_dairy                  10845 non-null  uint8         
<a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a> 18  category_frozen                 10845 non-null  uint8         
<a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a> 19  category_fruit                  10845 non-null  uint8         
<a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a> 20  category_kitchen                10845 non-null  uint8         
<a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a> 21  category_meat                   10845 non-null  uint8         
<a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a> 22  category_medicine               10845 non-null  uint8         
<a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a> 23  category_packaged foods         10845 non-null  uint8         
<a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a> 24  category_personal care          10845 non-null  uint8         
<a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a> 25  category_pets                   10845 non-null  uint8         
<a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a> 26  category_refrigerated items     10845 non-null  uint8         
<a id="__codelineno-24-33" name="__codelineno-24-33" href="#__codelineno-24-33"></a> 27  category_seafood                10845 non-null  uint8         
<a id="__codelineno-24-34" name="__codelineno-24-34" href="#__codelineno-24-34"></a> 28  category_snacks                 10845 non-null  uint8         
<a id="__codelineno-24-35" name="__codelineno-24-35" href="#__codelineno-24-35"></a> 29  category_spices and herbs       10845 non-null  uint8         
<a id="__codelineno-24-36" name="__codelineno-24-36" href="#__codelineno-24-36"></a> 30  category_vegetables             10845 non-null  uint8         
<a id="__codelineno-24-37" name="__codelineno-24-37" href="#__codelineno-24-37"></a>dtypes: datetime64[ns](1), float64(4), int64(3), object(1), uint8(22)
<a id="__codelineno-24-38" name="__codelineno-24-38" href="#__codelineno-24-38"></a>memory usage: 1.1+ MB
</code></pre></div>
<p>Okay, now that we have assembled our dataset, lets understand what we are actually modeling; our aim is to train a model that will be able to predict the <strong><code>estimated_stock_pct</code></strong></p>
<h3 id="modeling">Modeling<a class="headerlink" href="#modeling" title="Permanent link">&para;</a></h3>
<p>Time to do some modeling! <strong><code>estimated_stock_pct</code></strong> is our target variable.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">X</span> <span class="o">=</span> <span class="n">merged_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;estimated_stock_pct&#39;</span><span class="p">])</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="n">y</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;estimated_stock_pct&#39;</span><span class="p">]</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="c1"># (10845, 29)</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="c1"># (10845,)</span>
</code></pre></div>
<p>This shows that we have <strong>29 predictor variables</strong> that we will train our machine learning model on and 10845 rows of data. Now let's define how many folds we want to complete during training, and how much of the dataset to assign to training, leaving the rest for test. Let's create a loop to train K models with a <strong>75/25% random split</strong> of the data each time between training and test samples.</p>
<p>We repeat the training process <strong>10 times</strong> and average the <strong>MAE</strong> across the different test subsets</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span> <span class="k">as</span> <span class="n">tts</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">mean_absolute_error</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="n">K</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="n">split</span> <span class="o">=</span> <span class="mf">0.75</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="n">accuracy</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="k">for</span> <span class="n">fold</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>  <span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">()</span>
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>  <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">tts</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> 
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>                                         <span class="n">train_size</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span>
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>                                         <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>
<a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a>  <span class="n">trained_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a>  <span class="n">y_pred</span> <span class="o">=</span> <span class="n">trained_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a>
<a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a>  <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_pred</span><span class="p">)</span>
<a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a>  <span class="n">accuracy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mae</span><span class="p">)</span>
<a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a>  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fold </span><span class="si">{</span><span class="n">fold</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: MAE = </span><span class="si">{</span><span class="n">mae</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a>
<a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average MAE: </span><span class="si">{</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">accuracy</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">accuracy</span><span class="p">))</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>Fold 1: MAE = 0.236
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>Fold 2: MAE = 0.236
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>Fold 3: MAE = 0.237
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>Fold 4: MAE = 0.237
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>Fold 5: MAE = 0.236
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>Fold 6: MAE = 0.237
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>Fold 7: MAE = 0.236
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>Fold 8: MAE = 0.236
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>Fold 9: MAE = 0.236
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>Fold 10: MAE = 0.236
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>Average MAE: 0.24
</code></pre></div>
<p>We can see that the mean absolute error (<strong>MAE</strong>) is almost exactly the same each time, averaged to <strong>0.24</strong>. This is a good sign, it shows that the <strong>performance of the model is consistent across different random samples</strong> of the data, which is what we want. In other words, it shows a robust nature.</p>
<p><strong>MAE</strong> was chosen as a performance metric because it describes how closely the machine learning model was able to predict the exact value of <strong>estimated_stock_pct</strong></p>
<p>Even though the model is predicting robustly, this value for MAE is not so good, since the <strong>average value of the target variable is around 0.51</strong>, meaning that the accuracy as a percentage was around 50%. In an ideal world, we would want the MAE to be as low as possible.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">plotly.express</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">px</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="n">feat_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">))],</span><span class="n">features</span><span class="p">))</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="n">importances</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">importances</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="n">feature</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">feat_map</span><span class="o">.</span><span class="n">get</span><span class="p">,</span><span class="n">indices</span><span class="p">))</span>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="n">ldf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;feature&#39;</span><span class="p">:</span><span class="n">feature</span><span class="p">,</span>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>                   <span class="s1">&#39;importance&#39;</span><span class="p">:</span><span class="n">importances</span><span class="p">})</span>
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="n">ldf</span> <span class="o">=</span> <span class="n">ldf</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;importance&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="n">px</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">ldf</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;feature&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;importance&#39;</span><span class="p">,</span><span class="n">template</span><span class="o">=</span><span class="s1">&#39;plotly_white&#39;</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">700</span><span class="p">)</span>
</code></pre></div>
<p><img alt="" src="../../../images/fi_loop1.png" /></p>
<p>Despite not having an optimised model, we can still visualise the features that impact the model predictions. We can see that <strong>baked goods</strong> and <strong>baby products</strong> categories are important, however we should first optimise the model.</p>
<hr />
<h2 id="model-optimisation"><strong><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.573.677A.25.25 0 0 1 10 .854V2.5h1A2.5 2.5 0 0 1 13.5 5v5.628a2.251 2.251 0 1 1-1.5 0V5a1 1 0 0 0-1-1h-1v1.646a.25.25 0 0 1-.427.177L7.177 3.427a.25.25 0 0 1 0-.354ZM6 12v-1.646a.25.25 0 0 1 .427-.177l2.396 2.396a.25.25 0 0 1 0 .354l-2.396 2.396A.25.25 0 0 1 6 15.146V13.5H5A2.5 2.5 0 0 1 2.5 11V5.372a2.25 2.25 0 1 1 1.5 0V11a1 1 0 0 0 1 1ZM4 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0ZM12.75 12a.75.75 0 1 0 0 1.5.75.75 0 0 0 0-1.5Z"/></svg></span> Model Optimisation</strong><a class="headerlink" href="#model-optimisation" title="Permanent link">&para;</a></h2>
<p>Having a <strong>baseline</strong>, lets focus some attention to <strong>feature transformations</strong> as they can impact model accuracy. We'll also pay more attention to variations of machine learning models and utilise our knowledge of hyperaparameters and gridsearch optimisation to find the most optimal hyperparameters</p>
<ul>
<li><strong>Preprocessing</strong>: Filling NaN, Adding Date Features, Logarithmic Feature Transformation, Normalisation of features, <strong>label encoding</strong> with and without <strong>numerical column normalisation</strong></li>
<li><strong>Modeling</strong>: For modeling we investigate how different models perform using a gridsearch optimisation cycle for different models</li>
</ul>
<h3 id="recap-preprocessing">Recap Preprocessing<a class="headerlink" href="#recap-preprocessing" title="Permanent link">&para;</a></h3>
<p>Not a bad start start, however the client won't be satisfied with a model that performs this poorly, we need to make at least explore how well this model performs compared to other models for a start. We also need to spend more time on <strong>data preparation</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1"># read datasets</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="n">sales_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sales.csv&quot;</span><span class="p">)</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="n">sales_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Unnamed: 0&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="n">stock_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sensor_stock_levels.csv&quot;</span><span class="p">)</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="n">stock_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Unnamed: 0&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="n">temp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;sensor_storage_temperature.csv&quot;</span><span class="p">)</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="n">temp_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Unnamed: 0&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="k">def</span><span class="w"> </span><span class="nf">convert_to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>  <span class="n">dummy</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a>  <span class="n">dummy</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">dummy</span><span class="p">[</span><span class="n">column</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
<a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a>  <span class="k">return</span> <span class="n">dummy</span>
<a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a>
<a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="c1"># convert str to datetime</span>
<a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a><span class="n">sales_df</span> <span class="o">=</span> <span class="n">convert_to_datetime</span><span class="p">(</span><span class="n">sales_df</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
<a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a><span class="n">stock_df</span> <span class="o">=</span> <span class="n">convert_to_datetime</span><span class="p">(</span><span class="n">stock_df</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
<a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a><span class="n">temp_df</span> <span class="o">=</span> <span class="n">convert_to_datetime</span><span class="p">(</span><span class="n">temp_df</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
<a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a>
<a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a>
<a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a><span class="c1"># helper function to convert datetime to desired format</span>
<a id="__codelineno-29-22" name="__codelineno-29-22" href="#__codelineno-29-22"></a><span class="k">def</span><span class="w"> </span><span class="nf">convert_timestamp_to_hourly</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-29-23" name="__codelineno-29-23" href="#__codelineno-29-23"></a>  <span class="n">dummy</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-29-24" name="__codelineno-29-24" href="#__codelineno-29-24"></a>  <span class="n">new_ts</span> <span class="o">=</span> <span class="n">dummy</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="c1"># timestamp list [Timestamp(),Timestamp(),...]</span>
<a id="__codelineno-29-25" name="__codelineno-29-25" href="#__codelineno-29-25"></a>  <span class="n">new_ts</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:00:00&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">new_ts</span><span class="p">]</span> <span class="c1"># change the value of timestamp</span>
<a id="__codelineno-29-26" name="__codelineno-29-26" href="#__codelineno-29-26"></a>  <span class="n">new_ts</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:00:00&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">new_ts</span><span class="p">]</span> <span class="c1"># change to datetime</span>
<a id="__codelineno-29-27" name="__codelineno-29-27" href="#__codelineno-29-27"></a>  <span class="n">dummy</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_ts</span> <span class="c1"># replace</span>
<a id="__codelineno-29-28" name="__codelineno-29-28" href="#__codelineno-29-28"></a>  <span class="k">return</span> <span class="n">dummy</span>
<a id="__codelineno-29-29" name="__codelineno-29-29" href="#__codelineno-29-29"></a>
<a id="__codelineno-29-30" name="__codelineno-29-30" href="#__codelineno-29-30"></a><span class="c1"># convert datetime to hour approximation</span>
<a id="__codelineno-29-31" name="__codelineno-29-31" href="#__codelineno-29-31"></a><span class="n">sales_df</span> <span class="o">=</span> <span class="n">convert_timestamp_to_hourly</span><span class="p">(</span><span class="n">sales_df</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
<a id="__codelineno-29-32" name="__codelineno-29-32" href="#__codelineno-29-32"></a><span class="n">stock_df</span> <span class="o">=</span> <span class="n">convert_timestamp_to_hourly</span><span class="p">(</span><span class="n">stock_df</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
<a id="__codelineno-29-33" name="__codelineno-29-33" href="#__codelineno-29-33"></a><span class="n">temp_df</span> <span class="o">=</span> <span class="n">convert_timestamp_to_hourly</span><span class="p">(</span><span class="n">temp_df</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
<a id="__codelineno-29-34" name="__codelineno-29-34" href="#__codelineno-29-34"></a>
<a id="__codelineno-29-35" name="__codelineno-29-35" href="#__codelineno-29-35"></a><span class="c1"># aggregate data based on time &amp; product ID</span>
<a id="__codelineno-29-36" name="__codelineno-29-36" href="#__codelineno-29-36"></a><span class="c1"># total sales &amp; mean estimated stock percentage</span>
<a id="__codelineno-29-37" name="__codelineno-29-37" href="#__codelineno-29-37"></a><span class="c1"># add temperature aggregations for timestamp</span>
<a id="__codelineno-29-38" name="__codelineno-29-38" href="#__codelineno-29-38"></a><span class="n">sales_agg</span> <span class="o">=</span> <span class="n">sales_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;product_id&#39;</span><span class="p">],</span><span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;quantity&#39;</span><span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">})</span>
<a id="__codelineno-29-39" name="__codelineno-29-39" href="#__codelineno-29-39"></a><span class="n">stock_agg</span> <span class="o">=</span> <span class="n">stock_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;product_id&#39;</span><span class="p">],</span><span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;estimated_stock_pct&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">})</span>
<a id="__codelineno-29-40" name="__codelineno-29-40" href="#__codelineno-29-40"></a><span class="n">temp_agg</span> <span class="o">=</span> <span class="n">temp_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span><span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">temp_max</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;temperature&#39;</span><span class="p">,</span><span class="s2">&quot;mean&quot;</span><span class="p">),</span>
<a id="__codelineno-29-41" name="__codelineno-29-41" href="#__codelineno-29-41"></a>                                                             <span class="n">temp_min</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;temperature&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">),</span>
<a id="__codelineno-29-42" name="__codelineno-29-42" href="#__codelineno-29-42"></a>                                                             <span class="n">temp_median</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;temperature&#39;</span><span class="p">,</span><span class="s1">&#39;median&#39;</span><span class="p">),</span>
<a id="__codelineno-29-43" name="__codelineno-29-43" href="#__codelineno-29-43"></a>                                                             <span class="n">temp_mean</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;temperature&#39;</span><span class="p">,</span><span class="s1">&#39;mean&#39;</span><span class="p">))</span>
<a id="__codelineno-29-44" name="__codelineno-29-44" href="#__codelineno-29-44"></a>
<a id="__codelineno-29-45" name="__codelineno-29-45" href="#__codelineno-29-45"></a><span class="n">merged_df</span> <span class="o">=</span> <span class="n">stock_agg</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">sales_agg</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;product_id&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<a id="__codelineno-29-46" name="__codelineno-29-46" href="#__codelineno-29-46"></a><span class="n">merged_df</span> <span class="o">=</span> <span class="n">merged_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">temp_agg</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<a id="__codelineno-29-47" name="__codelineno-29-47" href="#__codelineno-29-47"></a><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-29-48" name="__codelineno-29-48" href="#__codelineno-29-48"></a>
<a id="__codelineno-29-49" name="__codelineno-29-49" href="#__codelineno-29-49"></a><span class="c1"># add features to aggregated dataframe </span>
<a id="__codelineno-29-50" name="__codelineno-29-50" href="#__codelineno-29-50"></a><span class="n">product_categories</span> <span class="o">=</span> <span class="n">sales_df</span><span class="p">[[</span><span class="s1">&#39;product_id&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">]]</span>
<a id="__codelineno-29-51" name="__codelineno-29-51" href="#__codelineno-29-51"></a><span class="n">product_categories</span> <span class="o">=</span> <span class="n">product_categories</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<a id="__codelineno-29-52" name="__codelineno-29-52" href="#__codelineno-29-52"></a><span class="n">product_price</span> <span class="o">=</span> <span class="n">sales_df</span><span class="p">[[</span><span class="s1">&#39;product_id&#39;</span><span class="p">,</span> <span class="s1">&#39;unit_price&#39;</span><span class="p">]]</span>
<a id="__codelineno-29-53" name="__codelineno-29-53" href="#__codelineno-29-53"></a><span class="n">product_price</span> <span class="o">=</span> <span class="n">product_price</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<a id="__codelineno-29-54" name="__codelineno-29-54" href="#__codelineno-29-54"></a><span class="n">merged_df</span> <span class="o">=</span> <span class="n">merged_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">product_categories</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;product_id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
<a id="__codelineno-29-55" name="__codelineno-29-55" href="#__codelineno-29-55"></a><span class="n">merged_df</span> <span class="o">=</span> <span class="n">merged_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">product_price</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;product_id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
<a id="__codelineno-29-56" name="__codelineno-29-56" href="#__codelineno-29-56"></a>
<a id="__codelineno-29-57" name="__codelineno-29-57" href="#__codelineno-29-57"></a><span class="c1"># add time based features</span>
<a id="__codelineno-29-58" name="__codelineno-29-58" href="#__codelineno-29-58"></a><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span>
<a id="__codelineno-29-59" name="__codelineno-29-59" href="#__codelineno-29-59"></a><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;dow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>
<a id="__codelineno-29-60" name="__codelineno-29-60" href="#__codelineno-29-60"></a><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
<a id="__codelineno-29-61" name="__codelineno-29-61" href="#__codelineno-29-61"></a><span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">merged_df</span><span class="o">.</span><span class="n">tail</span><span class="p">())</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>+-------------------+--------------------+-------------------+--------+--------------------+--------+-----------+--------------------+--------------+----------+---+---+----+
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>|          timestamp|          product_id|estimated_stock_pct|quantity|            temp_max|temp_min|temp_median|           temp_mean|      category|unit_price|day|dow|hour|
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>+-------------------+--------------------+-------------------+--------+--------------------+--------+-----------+--------------------+--------------+----------+---+---+----+
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>|2022-03-07 19:00:00|ecac012c-1dec-41d...|                0.5|     4.0|-0.16507739938080493|  -30.58|       0.18|-0.16507739938080493|         fruit|      4.99|  7|  0|  19|
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>|2022-03-07 19:00:00|ed7f6b14-67c9-42a...|               0.26|     0.0|-0.16507739938080493|  -30.58|       0.18|-0.16507739938080493|          meat|     19.99|  7|  0|  19|
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>|2022-03-07 19:00:00|edf4ac93-4e14-4a3...|               0.78|     3.0|-0.16507739938080493|  -30.58|       0.18|-0.16507739938080493|packaged foods|      6.99|  7|  0|  19|
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>|2022-03-07 19:00:00|f01b189c-6345-463...|               0.92|     3.0|-0.16507739938080493|  -30.58|       0.18|-0.16507739938080493|          meat|     14.99|  7|  0|  19|
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>|2022-03-07 19:00:00|f3bec808-bee0-459...|               0.01|     2.0|-0.16507739938080493|  -30.58|       0.18|-0.16507739938080493|     beverages|      5.19|  7|  0|  19|
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>+-------------------+--------------------+-------------------+--------+--------------------+--------+-----------+--------------------+--------------+----------+---+---+----+
</code></pre></div>
<h3 id="feature-transformations">Feature Transformations<a class="headerlink" href="#feature-transformations" title="Permanent link">&para;</a></h3>
<p>One of the important things to notice is whether the distribution itself is having an influence on the model evaluation metrics, so let's look into two forms for preprocessing; <strong>column transformation</strong> &amp; <strong>normalisation</strong> &amp; <strong>label encoding</strong></p>
<p>In the following section, we'll be creating different dataframe variations of <strong><code>merged_df</code></strong>:
- <strong><code>merged_df_tr</code></strong> : Which will contain only <strong>column transformations</strong> &amp; <strong>label encoding</strong>
- <strong><code>merged_df_tr_minmax</code></strong> : The same transformations as <strong><code>merged_df_tr</code></strong> but with the <strong>addition of normalisation</strong></p>
<h4 id="column-transformations"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 17H7V3h14m0-2H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2m-7 14h2V5h-4v2h2M3 5H1v16a2 2 0 0 0 2 2h16v-2H3V5Z"/></svg></span> Column Transformations<a class="headerlink" href="#column-transformations" title="Permanent link">&para;</a></h4>
<p>Let us now check the skewness values for each of the columns</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">skew</span><span class="p">,</span><span class="n">kurtosis</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="n">skew_data</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">skew</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="c1"># estimated_stock_pct    0.006773</span>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="c1"># quantity               2.384249</span>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="c1"># temp_median            0.068542</span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="c1"># unit_price             0.507440</span>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="c1"># day                   -0.002082</span>
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="c1"># dow                    0.002152</span>
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a><span class="c1"># hour                  -0.001072</span>
<a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a><span class="c1"># dtype: float64</span>
</code></pre></div>
<p>Our <strong>skewness</strong> value for <strong>quantity</strong> is rather high, lets use logarithmic transformation to modify the univariate distribution &amp; compare the boxplot distributions for the numeric columns</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="c1"># column transformations</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">log_column</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">columns</span><span class="p">):</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>    <span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>    <span class="k">return</span> <span class="n">df</span>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="n">merged_df_tr</span> <span class="o">=</span> <span class="n">log_column</span><span class="p">(</span><span class="n">merged_df</span><span class="p">,</span><span class="s1">&#39;quantity&#39;</span><span class="p">)</span>
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="n">px</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">merged_df_tr</span><span class="p">[</span><span class="n">c</span><span class="p">],</span>
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>       <span class="n">y</span><span class="o">=</span><span class="n">merged_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>       <span class="n">template</span><span class="o">=</span><span class="s1">&#39;plotly_white&#39;</span><span class="p">,</span>
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>       <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
<a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>       <span class="n">title</span><span class="o">=</span><span class="s1">&#39;univariate feature distribution&#39;</span><span class="p">)</span>
</code></pre></div>
<center>
![](images/before_box.png){width="300"} ![](images/after_box.png){width="300"}
</center>

<p>Looks much better now, lets also check the <strong>skewness metric</strong> once again to confirm we have a numeric improvement</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="n">skew_data</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">skew</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="c1"># estimated_stock_pct    0.006773</span>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="c1"># quantity               1.357097</span>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="c1"># temp_median            0.068542</span>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="c1"># unit_price             0.507440</span>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="c1"># day                   -0.002082</span>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="c1"># dow                    0.002152</span>
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="c1"># hour                  -0.001072</span>
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a><span class="c1"># dtype: float64</span>
</code></pre></div>
<h4 id="normalisation-of-columns"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 13h-4v-2h2a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-4v2h4v2h-2a2 2 0 0 0-2 2v4h6m4 2H7V3h14m0-2H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2M3 5H1v16a2 2 0 0 0 2 2h16v-2H3V5Z"/></svg></span> Normalisation of columns<a class="headerlink" href="#normalisation-of-columns" title="Permanent link">&para;</a></h4>
<p>Another often important column transformation is <strong>normalisation</strong>, let's utilise <strong>MinMax</strong> normalisation for numerical columns</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">MaxAbsScaler</span><span class="p">,</span><span class="n">Normalizer</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="c1"># column normalisation</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">normalise_columns</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">columns</span><span class="p">,</span><span class="n">norm_id</span><span class="p">):</span>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>    <span class="n">normaliser</span> <span class="o">=</span> <span class="n">Normalizer</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">norm_id</span><span class="p">)</span>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>    <span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="n">normaliser</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">])</span>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>    <span class="k">return</span> <span class="n">df</span>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="c1"># transformation &amp; minmax</span>
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="n">merged_df_tr_minmax</span> <span class="o">=</span> <span class="n">normalise_columns</span><span class="p">(</span><span class="n">merged_df_tr</span><span class="p">,</span><span class="n">numerical</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">LabelEncoder</span><span class="p">,</span><span class="n">OneHotEncoder</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="c1"># encoding transformations</span>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="n">le</span><span class="o">=</span><span class="n">LabelEncoder</span><span class="p">()</span>
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="n">merged_df_tr</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">le</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">merged_df_tr</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">])</span>
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="n">merged_df_tr_minmax</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">le</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">merged_df_tr_minmax</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">])</span>
</code></pre></div>
<h3 id="helper-functions">Helper Functions<a class="headerlink" href="#helper-functions" title="Permanent link">&para;</a></h3>
<p>Its good practice to start grouping things that will allow us to automate the machine learning training loop</p>
<ul>
<li><code>split_data</code> will be used to remove irrelovant columns (this will be standard for all incoming dataframes) &amp; do a train/test split of the dataset, so we can do both <strong>evaluation</strong> &amp; <strong>test</strong> metric accessments (via GridSearch + Test set)</li>
<li><code>p</code> &amp; <code>pt</code> functions are used for <strong>cross validation</strong> &amp; <strong>train/test split</strong> metric assessment using <strong>MAE</strong></li>
<li>We'll try a variety of models:<ul>
<li><strong>HistGradientBoostingRegressor</strong> (More efficient Gradient Boosting)</li>
<li><strong>AdaBoostRegressor</strong> (Simple Gradient Boosting)</li>
<li><strong>RandomForestRegressor</strong> (Decision Tree Ensemble)</li>
<li><strong>SGDRegressor</strong> (Optimisable LR w/ regularisation options in gradient boosting etc)</li>
<li><strong>ARDRegression</strong> (LR that automatically determines the relevance of each feature in making predictions)</li>
</ul>
</li>
</ul>
<p>And we'll conclude which performs best</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span> <span class="k">as</span> <span class="n">tts</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="k">def</span><span class="w"> </span><span class="nf">split_data</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>    <span class="c1"># remove product_id, category</span>
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">difference</span><span class="p">([</span><span class="s1">&#39;product_id&#39;</span><span class="p">,</span><span class="s1">&#39;category&#39;</span><span class="p">])]</span>
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a>    <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">estimated_stock_pct</span>
<a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a>    <span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;estimated_stock_pct&#39;</span><span class="p">)</span>
<a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a>
<a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a>    <span class="n">xtrain</span> <span class="p">,</span> <span class="n">xtest</span><span class="p">,</span> <span class="n">ytrain</span><span class="p">,</span> <span class="n">ytest</span> <span class="o">=</span> <span class="n">tts</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">train_size</span><span class="o">=</span><span class="mf">.75</span><span class="p">)</span>
<a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;xtrain: </span><span class="si">{</span><span class="n">xtrain</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> and xtest: </span><span class="si">{</span><span class="n">xtest</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ytrain: </span><span class="si">{</span><span class="n">ytrain</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> and ytest: </span><span class="si">{</span><span class="n">ytest</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a>    <span class="k">return</span> <span class="n">xtrain</span><span class="p">,</span><span class="n">xtest</span><span class="p">,</span><span class="n">ytrain</span><span class="p">,</span><span class="n">ytest</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="c1"># randomised gridsearch cross validation (7 kfolds)</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">p</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>    <span class="n">pt</span><span class="o">=</span><span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">model</span><span class="p">,</span><span class="n">cv</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>                          <span class="n">param_distributions</span><span class="o">=</span><span class="n">g</span><span class="p">,</span>
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>                          <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>                          <span class="n">random_state</span><span class="o">=</span><span class="mi">344</span><span class="p">)</span>
<a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a>
<a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a>    <span class="n">pt</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">xtrain</span><span class="p">,</span><span class="n">ytrain</span><span class="p">)</span>
<a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a>    <span class="n">best</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">best_estimator_</span>
<a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a>    <span class="n">best</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">xtrain</span><span class="p">,</span><span class="n">ytrain</span><span class="p">)</span>
<a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a>    <span class="n">ypred</span> <span class="o">=</span> <span class="n">best</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">xtest</span><span class="p">)</span>
<a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a>
<a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a>    <span class="n">pk</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">best</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">.pkl&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">))</span>
<a id="__codelineno-37-14" name="__codelineno-37-14" href="#__codelineno-37-14"></a>    <span class="k">return</span> <span class="n">name</span><span class="p">,</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">ytest</span><span class="p">,</span><span class="n">ypred</span><span class="p">)</span>
<a id="__codelineno-37-15" name="__codelineno-37-15" href="#__codelineno-37-15"></a>
<a id="__codelineno-37-16" name="__codelineno-37-16" href="#__codelineno-37-16"></a><span class="c1"># Standard Train/Test evaluation</span>
<a id="__codelineno-37-17" name="__codelineno-37-17" href="#__codelineno-37-17"></a><span class="k">def</span><span class="w"> </span><span class="nf">pt</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
<a id="__codelineno-37-18" name="__codelineno-37-18" href="#__codelineno-37-18"></a>    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">xtrain</span><span class="p">,</span><span class="n">ytrain</span><span class="p">)</span>
<a id="__codelineno-37-19" name="__codelineno-37-19" href="#__codelineno-37-19"></a>    <span class="n">ypred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">xtest</span><span class="p">)</span>
<a id="__codelineno-37-20" name="__codelineno-37-20" href="#__codelineno-37-20"></a>    <span class="n">pk</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">.pkl&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">))</span>
<a id="__codelineno-37-21" name="__codelineno-37-21" href="#__codelineno-37-21"></a>    <span class="k">return</span> <span class="n">name</span><span class="p">,</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">ytest</span><span class="p">,</span><span class="n">ypred</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">check_models</span><span class="p">():</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>    <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:[],</span><span class="s1">&#39;mae&#39;</span><span class="p">:[]}</span>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a>    <span class="c1"># Histogram Gradient Boosting</span>
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a>    <span class="n">h</span><span class="o">=</span><span class="n">HistGradientBoostingRegressor</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">34563</span><span class="p">,</span>
<a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a>                                    <span class="n">max_bins</span><span class="o">=</span><span class="mi">244</span><span class="p">,</span>
<a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a>                                    <span class="n">max_depth</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a>
<a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a>    <span class="n">g</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">:[</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.01</span><span class="p">],</span>
<a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a>    <span class="s1">&#39;max_iter&#39;</span><span class="p">:[</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">500</span><span class="p">,</span><span class="mi">600</span><span class="p">,</span><span class="mi">800</span><span class="p">,</span><span class="mi">900</span><span class="p">],</span>
<a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a>    <span class="s1">&#39;max_leaf_nodes&#39;</span><span class="p">:[</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">],</span>
<a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a>    <span class="s1">&#39;l2_regularization&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.01</span><span class="p">],</span>
<a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a>    <span class="s1">&#39;tol&#39;</span><span class="p">:[</span><span class="mf">1e-7</span><span class="p">,</span><span class="mf">1e-8</span><span class="p">]}</span>
<a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a>
<a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a>    <span class="n">name</span><span class="p">,</span><span class="n">mae</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="s1">&#39;histgrdbstreg&#39;</span><span class="p">)</span>
<a id="__codelineno-38-17" name="__codelineno-38-17" href="#__codelineno-38-17"></a>    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">);</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;mae&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mae</span><span class="p">)</span>
<a id="__codelineno-38-18" name="__codelineno-38-18" href="#__codelineno-38-18"></a>
<a id="__codelineno-38-19" name="__codelineno-38-19" href="#__codelineno-38-19"></a>    <span class="c1"># Adaboost Gradient Boosting</span>
<a id="__codelineno-38-20" name="__codelineno-38-20" href="#__codelineno-38-20"></a>    <span class="n">ada</span><span class="o">=</span><span class="n">AdaBoostRegressor</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">16</span><span class="p">))</span>
<a id="__codelineno-38-21" name="__codelineno-38-21" href="#__codelineno-38-21"></a>
<a id="__codelineno-38-22" name="__codelineno-38-22" href="#__codelineno-38-22"></a>    <span class="n">grid</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">:[</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span>
<a id="__codelineno-38-23" name="__codelineno-38-23" href="#__codelineno-38-23"></a>        <span class="s1">&#39;learning_rate&#39;</span><span class="p">:[</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">1.6</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
<a id="__codelineno-38-24" name="__codelineno-38-24" href="#__codelineno-38-24"></a>        <span class="s1">&#39;loss&#39;</span><span class="p">:[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="s1">&#39;exponential&#39;</span><span class="p">]}</span>
<a id="__codelineno-38-25" name="__codelineno-38-25" href="#__codelineno-38-25"></a>
<a id="__codelineno-38-26" name="__codelineno-38-26" href="#__codelineno-38-26"></a>    <span class="n">name</span><span class="p">,</span><span class="n">mae</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span><span class="n">ada</span><span class="p">,</span><span class="s1">&#39;adabstreg&#39;</span><span class="p">)</span>
<a id="__codelineno-38-27" name="__codelineno-38-27" href="#__codelineno-38-27"></a>    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">);</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;mae&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mae</span><span class="p">)</span>
<a id="__codelineno-38-28" name="__codelineno-38-28" href="#__codelineno-38-28"></a>
<a id="__codelineno-38-29" name="__codelineno-38-29" href="#__codelineno-38-29"></a>    <span class="c1"># Bagging Regressor</span>
<a id="__codelineno-38-30" name="__codelineno-38-30" href="#__codelineno-38-30"></a>    <span class="n">bag</span><span class="o">=</span><span class="n">BaggingRegressor</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">17</span><span class="p">),</span>
<a id="__codelineno-38-31" name="__codelineno-38-31" href="#__codelineno-38-31"></a>                        <span class="n">oob_score</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-38-32" name="__codelineno-38-32" href="#__codelineno-38-32"></a>                        <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-38-33" name="__codelineno-38-33" href="#__codelineno-38-33"></a>
<a id="__codelineno-38-34" name="__codelineno-38-34" href="#__codelineno-38-34"></a>    <span class="n">bgrid</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">:[</span><span class="mi">10</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">16</span><span class="p">]}</span>
<a id="__codelineno-38-35" name="__codelineno-38-35" href="#__codelineno-38-35"></a>    <span class="n">name</span><span class="p">,</span> <span class="n">mae</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="n">bgrid</span><span class="p">,</span><span class="n">bag</span><span class="p">,</span><span class="s1">&#39;bagreg&#39;</span><span class="p">)</span>
<a id="__codelineno-38-36" name="__codelineno-38-36" href="#__codelineno-38-36"></a>    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">);</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;mae&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mae</span><span class="p">)</span>
<a id="__codelineno-38-37" name="__codelineno-38-37" href="#__codelineno-38-37"></a>
<a id="__codelineno-38-38" name="__codelineno-38-38" href="#__codelineno-38-38"></a>    <span class="c1"># Random Forest</span>
<a id="__codelineno-38-39" name="__codelineno-38-39" href="#__codelineno-38-39"></a>    <span class="n">r</span><span class="o">=</span><span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">oob_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-38-40" name="__codelineno-38-40" href="#__codelineno-38-40"></a>
<a id="__codelineno-38-41" name="__codelineno-38-41" href="#__codelineno-38-41"></a>    <span class="n">rgrid</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;max_depth&#39;</span><span class="p">:[</span><span class="mi">170</span><span class="p">,</span><span class="mi">190</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">210</span><span class="p">],</span>
<a id="__codelineno-38-42" name="__codelineno-38-42" href="#__codelineno-38-42"></a>        <span class="s1">&#39;max_features&#39;</span><span class="p">:[</span><span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="s1">&#39;log2&#39;</span><span class="p">],</span>
<a id="__codelineno-38-43" name="__codelineno-38-43" href="#__codelineno-38-43"></a>        <span class="s1">&#39;max_samples&#39;</span><span class="p">:[</span><span class="mi">30</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">200</span><span class="p">],</span>
<a id="__codelineno-38-44" name="__codelineno-38-44" href="#__codelineno-38-44"></a>        <span class="s1">&#39;max_leaf_nodes&#39;</span><span class="p">:[</span><span class="mi">20</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">100</span><span class="p">]}</span>
<a id="__codelineno-38-45" name="__codelineno-38-45" href="#__codelineno-38-45"></a>
<a id="__codelineno-38-46" name="__codelineno-38-46" href="#__codelineno-38-46"></a>    <span class="n">name</span><span class="p">,</span><span class="n">mae</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="n">rgrid</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="s1">&#39;randfrstreg&#39;</span><span class="p">)</span>
<a id="__codelineno-38-47" name="__codelineno-38-47" href="#__codelineno-38-47"></a>    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">);</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;mae&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mae</span><span class="p">)</span>
<a id="__codelineno-38-48" name="__codelineno-38-48" href="#__codelineno-38-48"></a>
<a id="__codelineno-38-49" name="__codelineno-38-49" href="#__codelineno-38-49"></a>    <span class="c1"># Stochastic Gradient Regressor</span>
<a id="__codelineno-38-50" name="__codelineno-38-50" href="#__codelineno-38-50"></a>    <span class="n">sgd</span><span class="o">=</span><span class="n">SGDRegressor</span><span class="p">()</span>
<a id="__codelineno-38-51" name="__codelineno-38-51" href="#__codelineno-38-51"></a>    <span class="n">sgdg</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;penalty&#39;</span><span class="p">:[</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span> <span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="s1">&#39;elasticnet&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-38-52" name="__codelineno-38-52" href="#__codelineno-38-52"></a>        <span class="s1">&#39;max_iter&#39;</span><span class="p">:[</span><span class="mi">100</span><span class="p">,</span><span class="mi">400</span><span class="p">,</span><span class="mi">800</span><span class="p">],</span>
<a id="__codelineno-38-53" name="__codelineno-38-53" href="#__codelineno-38-53"></a>        <span class="s1">&#39;tol&#39;</span><span class="p">:[</span><span class="mf">1e-3</span><span class="p">,</span><span class="mf">1e-5</span><span class="p">,</span><span class="mf">1e-8</span><span class="p">],</span>
<a id="__codelineno-38-54" name="__codelineno-38-54" href="#__codelineno-38-54"></a>        <span class="s1">&#39;alpha&#39;</span><span class="p">:[</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">.001</span><span class="p">,</span><span class="mf">0.0001</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-38-55" name="__codelineno-38-55" href="#__codelineno-38-55"></a>        <span class="s1">&#39;learning_rate&#39;</span><span class="p">:[</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span><span class="s1">&#39;optimal&#39;</span><span class="p">,</span><span class="s1">&#39;invscaling&#39;</span><span class="p">,</span><span class="s1">&#39;adaptive&#39;</span><span class="p">]</span>
<a id="__codelineno-38-56" name="__codelineno-38-56" href="#__codelineno-38-56"></a>        <span class="p">}</span>
<a id="__codelineno-38-57" name="__codelineno-38-57" href="#__codelineno-38-57"></a>    <span class="n">name</span><span class="p">,</span> <span class="n">mae</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="n">sgdg</span><span class="p">,</span><span class="n">sgd</span><span class="p">,</span><span class="s1">&#39;sgdreg&#39;</span><span class="p">)</span>
<a id="__codelineno-38-58" name="__codelineno-38-58" href="#__codelineno-38-58"></a>    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">);</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;mae&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mae</span><span class="p">)</span>
<a id="__codelineno-38-59" name="__codelineno-38-59" href="#__codelineno-38-59"></a>
<a id="__codelineno-38-60" name="__codelineno-38-60" href="#__codelineno-38-60"></a>    <span class="c1"># Bayesian ARD regression.</span>
<a id="__codelineno-38-61" name="__codelineno-38-61" href="#__codelineno-38-61"></a>    <span class="n">a</span><span class="o">=</span><span class="n">ARDRegression</span><span class="p">()</span>
<a id="__codelineno-38-62" name="__codelineno-38-62" href="#__codelineno-38-62"></a>    <span class="n">gg</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;alpha_1&#39;</span><span class="p">:[</span><span class="mf">1e-3</span><span class="p">,</span><span class="mf">1e-5</span><span class="p">,</span><span class="mf">1e-7</span><span class="p">,</span><span class="mf">1e-9</span><span class="p">],</span>
<a id="__codelineno-38-63" name="__codelineno-38-63" href="#__codelineno-38-63"></a>    <span class="s1">&#39;alpha_2&#39;</span><span class="p">:[</span><span class="mf">1e-3</span><span class="p">,</span><span class="mf">1e-5</span><span class="p">,</span><span class="mf">1e-7</span><span class="p">],</span>
<a id="__codelineno-38-64" name="__codelineno-38-64" href="#__codelineno-38-64"></a>    <span class="s1">&#39;lambda_1&#39;</span><span class="p">:[</span><span class="mf">1e-1</span><span class="p">,</span><span class="mf">1e-3</span><span class="p">,</span><span class="mf">1e-5</span><span class="p">,</span><span class="mf">1e-7</span><span class="p">],</span>
<a id="__codelineno-38-65" name="__codelineno-38-65" href="#__codelineno-38-65"></a>    <span class="s1">&#39;n_iter&#39;</span><span class="p">:[</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">300</span><span class="p">],</span>
<a id="__codelineno-38-66" name="__codelineno-38-66" href="#__codelineno-38-66"></a>    <span class="s1">&#39;lambda_2&#39;</span><span class="p">:[</span><span class="mf">1e-3</span><span class="p">,</span><span class="mf">1e-5</span><span class="p">,</span><span class="mf">1e-7</span><span class="p">,</span><span class="mf">1e-9</span><span class="p">],</span>
<a id="__codelineno-38-67" name="__codelineno-38-67" href="#__codelineno-38-67"></a>    <span class="s1">&#39;tol&#39;</span><span class="p">:[</span><span class="mf">1e-3</span><span class="p">,</span><span class="mf">1e-5</span><span class="p">,</span><span class="mf">1e-7</span><span class="p">,</span><span class="mf">1e-9</span><span class="p">]}</span>
<a id="__codelineno-38-68" name="__codelineno-38-68" href="#__codelineno-38-68"></a>
<a id="__codelineno-38-69" name="__codelineno-38-69" href="#__codelineno-38-69"></a>    <span class="n">name</span><span class="p">,</span> <span class="n">mae</span> <span class="o">=</span> <span class="n">p</span><span class="p">(</span><span class="n">gg</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="s1">&#39;ardreg&#39;</span><span class="p">)</span>
<a id="__codelineno-38-70" name="__codelineno-38-70" href="#__codelineno-38-70"></a>    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">);</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;mae&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mae</span><span class="p">)</span>
<a id="__codelineno-38-71" name="__codelineno-38-71" href="#__codelineno-38-71"></a>
<a id="__codelineno-38-72" name="__codelineno-38-72" href="#__codelineno-38-72"></a>    <span class="k">return</span> <span class="n">results</span>
</code></pre></div>
<h3 id="training-models">Training Models<a class="headerlink" href="#training-models" title="Permanent link">&para;</a></h3>
<p>Having defined all the helper functions above, the actual training code is very minimal, we'll store the <strong>MAE</strong> metrics of all tested models for both datasets that we're testing in <strong>results_tr</strong> and <strong>merged_df_tr_minmax</strong></p>
<p>First of all, our <strong>baseline with gridsearchcv</strong>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="n">xtrain</span><span class="p">,</span><span class="n">xtest</span><span class="p">,</span><span class="n">ytrain</span><span class="p">,</span><span class="n">ytest</span> <span class="o">=</span> <span class="n">split_data</span><span class="p">(</span><span class="n">merged_df</span><span class="p">)</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="n">pt</span><span class="p">(</span><span class="n">RandomForestRegressor</span><span class="p">(),</span><span class="s1">&#39;randomforest&#39;</span><span class="p">)</span>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="c1"># (&#39;randomforest&#39;, 0.25014228782291775)</span>
</code></pre></div>
<p>Our feature engineering modifications:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1"># column transformation</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="n">xtrain</span><span class="p">,</span><span class="n">xtest</span><span class="p">,</span><span class="n">ytrain</span><span class="p">,</span><span class="n">ytest</span> <span class="o">=</span> <span class="n">split_data</span><span class="p">(</span><span class="n">merged_df_tr</span><span class="p">)</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="n">results_tr</span> <span class="o">=</span> <span class="n">check_models</span><span class="p">()</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">results_tr_minmax</span><span class="p">[</span><span class="s1">&#39;mae&#39;</span><span class="p">])</span> <span class="c1"># 0.2253</span>
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="c1"># column transformation + normalisation</span>
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="n">xtrain</span><span class="p">,</span><span class="n">xtest</span><span class="p">,</span><span class="n">ytrain</span><span class="p">,</span><span class="n">ytest</span> <span class="o">=</span> <span class="n">split_data</span><span class="p">(</span><span class="n">merged_df_tr_minmax</span><span class="p">)</span>
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="n">results_tr_minmax</span> <span class="o">=</span> <span class="n">check_models</span><span class="p">()</span>
<a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">results_tr_minmax</span><span class="p">[</span><span class="s1">&#39;mae&#39;</span><span class="p">])</span>  <span class="c1"># 0.2268</span>
</code></pre></div>
<h2 id="contact-with-client"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 18H9a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h1v5l2-1.5L14 7V2h5a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2m-2 2v2H5a2 2 0 0 1-2-2V6h2v14h12Z"/></svg></span> <strong>Contact with Client</strong><a class="headerlink" href="#contact-with-client" title="Permanent link">&para;</a></h2>
<blockquote>
<p>Most importantly, once the modeling process is complete, we need you to communicate your work and analysis in the form of a single PowerPoint slide, so that we can present the results back to the business. The key here is to use business-friendly language and to explain your results in a way that the business will understand. For example, ensure that when you‚Äôre summarizing the performance of the results you don‚Äôt use technical metrics, but rather convert it into numbers that they‚Äôll understand. </p>
</blockquote>
<p>To summarise the results of the modeling phase, it is suggested to utilise two figures:</p>
<ul>
<li>
<p>Feature importance using tuned tree based model</p>
<ul>
<li>importance will allow us to convey the importance of different factors that affect the results </li>
</ul>
</li>
<li>
<p>Relative metric results of all models</p>
<ul>
<li>The data used for training the models may not be diverse enough or may not contain enough relevant features to effectively differentiate between different models. It could also indicate that the models are not capturing the complexity of the underlying data, or that the models are not being trained with enough variability in the input data. In such cases, it may be necessary to re-evaluate the feature selection process, gather more diverse and relevant data,</li>
</ul>
</li>
</ul>
<p><img alt="" src="../../../images/task3.png" /></p>
<p>In response to the presentation:</p>
<blockquote>
<p><strong>Gala Groceries</strong> saw the results of the machine learning model as promising and believe that with more data and time, it can add real value to the business.</p>
</blockquote>
<h2 id="concluding-remarks"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 18H9a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h1v5l2-1.5L14 7V2h5a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2m-2 2v2H5a2 2 0 0 1-2-2V6h2v14h12Z"/></svg></span> <strong>Concluding Remarks</strong><a class="headerlink" href="#concluding-remarks" title="Permanent link">&para;</a></h2>
<p>This was a rather interesting project focusing on how a client tries to improve their business by utilising artificial intelligence</p>
<ul>
<li>The client had a general idea of what they wanted, and in the process of completing the project a specific project goal was created</li>
<li>Based on the sales and sensor data that the client has integrated into their business, we were able to create a production ready model which the <strong>DevOps</strong> team has implemented. </li>
<li>The early feedback implied that the model was rather underperforming because it was most likely underfitting the data, we simply haven't gathered enough data for the model to start performing optimally.</li>
<li>Nevertheless, we went through the entire data scientist cycle and obtained optimised models that with the help of data preprocessing were able to score <strong>MAE</strong> in the region of 0.22, which is about 10% less that the initial baseline that we tried.</li>
</ul>







  
  



  


  


  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        Was this page helpful?
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page was helpful!" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14 20h-4v-9l-3.5 3.5-2.42-2.42L12 4.16l7.92 7.92-2.42 2.42L14 11v9Z"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page could be improved!" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 4h4v9l3.5-3.5 2.42 2.42L12 19.84l-7.92-7.92L6.5 9.5 10 13V4Z"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              Thanks for your feedback!
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              Thanks for your feedback!
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


      
    </article>
  </div>

          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023-2025 <a href="https://github.com/shtrausslearning"  target="_blank" rel="noopener">Andrey Shtrauss</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/shtrausslearning" target="_blank" rel="noopener" title="shtrausslearning" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.kaggle/shtraussleaning" target="_blank" rel="noopener" title="shtrausslearning" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M304.2 501.5 158.4 320.3 298.2 185c2.6-2.7 1.7-10.5-5.3-10.5h-69.2c-3.5 0-7 1.8-10.5 5.3L80.9 313.5V7.5q0-7.5-7.5-7.5H21.5Q14 0 14 7.5v497q0 7.5 7.5 7.5h51.9q7.5 0 7.5-7.5v-109l30.8-29.3 110.5 140.6c3 3.5 6.5 5.3 10.5 5.3h66.9q5.25 0 6-3z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://t.me/mldsai_info" target="_blank" rel="noopener" title="mldsai-info" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M248 8C111.033 8 0 119.033 0 256s111.033 248 248 248 248-111.033 248-248S384.967 8 248 8Zm114.952 168.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452 0 0 1 3.53 6.716 43.765 43.765 0 0 1 .417 9.769Z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["header.autohide", "content.code.annotate", "content.code.copy", "content.code.select", "content.tabs.link", "content.tooltips", "navigation.indexes", "navigation.path", "navigation.tabs", "navigation.top", "search.highlight", "search.suggest", "navigation.sections"], "search": "../../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.1e8ae164.min.js"></script>
      
        <script src="../../../../javascripts/katex.js"></script>
      
        <script src="../../../../javascripts/extra.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>